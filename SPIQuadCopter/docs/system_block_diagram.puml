@startuml
title SPIQuadCopter System Block Diagram

package "SPI Master\n(Raspberry Pi)" as SPI_MASTER {
}

SPI_MASTER -down-> "SPI-to-Wishbone Bridge" as SPI_BRIDGE

package "Wishbone Peripherals" as WB {
  [LED Controller\n(0x0000)\no_led[3:0]] as LED
  [DSHOT Controller\n(0x0100)\ndshot_out[3:0]] as DSHOT
  [PWM Decoder\n(0x0200)\npwm_in[5:0]] as PWM
  [NeoPixel Ctrl\n(0x0300)\nneopixel_data] as NEOPX
  [Serial/DSHOT Mux\n(0x0400)\nmux_sel] as MUX
  [Version Reg\n(0x1FF0)] as VER
}

SPI_BRIDGE -down-> WB
SPI_BRIDGE --> LED
SPI_BRIDGE --> DSHOT
SPI_BRIDGE --> PWM
SPI_BRIDGE --> NEOPX
SPI_BRIDGE --> MUX
SPI_BRIDGE --> VER

package "UART Passthrough (standalone)" as PASSTHROUGH {
  [usb_uart_rx (to PC)] as USB_RX
  [usb_uart_tx (from PC)] as USB_TX
  [serial_tx_out (to ESC)] as SER_TX
  [serial_rx_in (from ESC)] as SER_RX
}

PASSTHROUGH .. SPI_BRIDGE
USB_RX --> PASSTHROUGH
PASSTHROUGH --> USB_TX
PASSTHROUGH --> SER_TX
SER_RX --> PASSTHROUGH

@enduml
